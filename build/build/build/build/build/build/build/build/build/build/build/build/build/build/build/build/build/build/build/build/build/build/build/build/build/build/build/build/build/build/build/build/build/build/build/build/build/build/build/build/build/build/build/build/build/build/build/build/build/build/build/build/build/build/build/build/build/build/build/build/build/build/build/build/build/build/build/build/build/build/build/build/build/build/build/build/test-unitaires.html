<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Julie Aubert, Rémi Patin" />


<title>Tests unitaires et bonnes pratiques de développement de package</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Finist'R 2021</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://github.com/StateOfTheR/finistR2021">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="instructions.html">
    <span class="fa fa-gear"></span>
     
    Workflow
  </a>
</li>
<li>
  <a href="datavizu.html">
    <span class="fa fa-desktop"></span>
     
    Nouvelles Fonctions Graphiques
  </a>
</li>
<li>
  <a href="deepnote.html">
    <span class="fa fa-user-graduate"></span>
     
    Enseignement
  </a>
</li>
<li>
  <a href="webpages.html">
    <span class="fa fa-address-book-o"></span>
     
    Site Web
  </a>
</li>
<li>
  <a href="xarigan_flipbook.html">
    <span class="fa fa-slideshare"></span>
     
    Présentations
  </a>
</li>
<li>
  <a href="shiny.html">Shiny</a>
</li>
<li>
  <a href="test-unitaires.html">
    <span class="fa fa-box-open"></span>
     
    Package et tests
  </a>
</li>
<li>
  <a href="openmp.html">OpenMP</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Tests unitaires et bonnes pratiques de développement de package</h1>
<h4 class="author">Julie Aubert, Rémi Patin</h4>
<h4 class="date">24 et 25/08/2020</h4>

</div>


<div id="bonnes-pratiques-quelques-packages-utiles" class="section level2">
<h2>Bonnes pratiques : quelques packages utiles</h2>
<p><a href="https://github.com/MangoTheCat/goodpractice"><code>goodpractice</code></a> fournit des conseils sur les bonnes pratiques lorsqu’on construit un package R. Le package identifie les zones de codes qui pourraient être améliorées. Les conseils incluent les fonctions et syntaxes à éviter, la structure du package, la complexité du code, le formatage du code.</p>
<p><a href="https://github.com/yihui/formatR"><code>formatR</code></a> et <a href="https://github.com/r-lib/styler"><code>styler</code></a> pour reformater du code.</p>
<p><a href="https://github.com/r-lib/covr"><code>covr</code></a> permet d’estimer la couverture du package par des tests ainsi que l’identification des fonctions ou zone de code, peu ou pas couvertes par des tests.</p>
<p><a href="https://github.com/r-lib/usethis"><code>usethis</code></a> et en particulier <code>usethis::use_spell_check()</code> (basé sur <a href="https://github.com/ropensci/spelling"><code>spelling</code></a> ) qui permet d’identifier facilement les fautes de frappes et les noms incohérents dans le code.</p>
</div>
<div id="un-package-cosmétique" class="section level2">
<h2>Un package cosmétique</h2>
<p><a href="https://github.com/r-lib/cli"><code>cli</code></a> permet de faciliter la communication avec l’utilisateur grâce à des symboles faciles à insérer et des barres de progression pratiques.</p>
</div>
<div id="quelques-packages-utiles-pour-réaliser-des-tests" class="section level2">
<h2>Quelques packages utiles pour réaliser des tests</h2>
<p>Lorsqu’on construit un package, il est fortement conseillé d’inclure des tests dans le répertoire <em>tests/</em> du package, qui ont pour but de vérifier que l’ensemble des fonctions du package ont un comportement approprié, notamment :</p>
<ul>
<li>les objets de sorties sont au format attendu</li>
<li>quand la fonction tourne avec un exemple choisi, le résultat doit correspondre à l’attendu</li>
<li>les appels de fonctions avec de mauvais paramètres renvoient bien des erreurs</li>
<li>les appels de fonctions avec des paramètres obsolètes renvoient bien des warnings</li>
</ul>
<div id="rappel-sur-les-tests-unitaires-et-présentation-de-tinytest-une-alternative-à-testthat" class="section level3">
<h3>Rappel sur les tests unitaires et présentation de <code>tinytest</code>, une alternative à <code>testthat</code></h3>
<p>Le package <a href="https://github.com/markvanderloo/tinytest"><code>tinytest</code></a> est un package relativement récent (~2 ans pour les premières versions) visant à proposer une alternative à <code>testthat</code>. Pour rappel <a href="https://testthat.r-lib.org/"><code>testthat</code></a> et donc <code>tinytest</code> permettent de réaliser facilement un certains nombre de tests unitaires à l’aide de fonctions sous la forme <code>expect_xxx</code> pour vérifier si le résultat d’une fonction :</p>
<ul>
<li>est égal à l’attendu, ce qui prends en compte les attributs (<code>expect_equal</code>)</li>
<li>est équivalent à l’attendu, ce qui ignore les attributs (<code>expect_equivalent</code>)</li>
<li>est strictement identique à l’attendy, byte par byte, ce qui peux prendre en compte des différences d’environnements (<code>expect_identical</code>)</li>
<li>est une valeur nulle (<code>expect_null</code>)</li>
<li>est une valeur vrai ou fausse (<code>expect_true</code> ou <code>expect_false</code>)</li>
<li>renvoie un message (<code>expect_message</code>)</li>
<li>renvoie un warning (<code>expect_warning</code>)</li>
<li>renvoie une erreur (<code>expect_error</code>)</li>
<li>tourne sans problème ni message (<code>expect_silent</code>)</li>
</ul>
<p>L’ensemble de ces tests doit permettre de vérifier que la fonction réagit correctement à toutes les possibilités d’appels de la fonction, si les erreurs possibles sont correctement gérées et si le fonctionnement attendu est correct.</p>
<p>Ces différents types de tests étaient déjà posssible avec le package <code>testthat</code>, mais le développement récent de <code>tinytest</code> permet une alternative avec quelques avantages en plus :</p>
<ul>
<li><code>tinytest</code> dépend d’un nombre de package plus réduit (2 vs 12), ce qui rend plus simple son utilisation dans le cadre d’une intégration continue.</li>
<li>Les fonctions de <code>tinytest</code> ne renvoient pas d’erreur lors de l’échec d’un test, ce qui permet de finir l’évaluation de l’ensemble des tests malgré l’échec d’un test, sans avoir à utiliser <code>testthat::test_that</code>.</li>
<li>Les fonctions de <code>tinytest</code> donnent plus de détail sur l’échec d’un test et sont capables de prendre en compte potentiellement plus de changements dans l’environnement.</li>
</ul>
<p>Exemple de test avec <code>testthat</code>. Noter l’utilisation de <code>testthat::test_that</code> pour ne pas bloquer l’éxecution du code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;Test A&quot;</span>, {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="at">object =</span> <span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">expected =</span> <span class="dv">2</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Failure (&lt;text&gt;:2:3): Test A ────────────────────────────────────────────────
## 2 + 1 not equal to 2.
## 1/1 mismatches
## [1] 3 - 2 == 1</code></pre>
<p>Exemple de test avec <code>tinytest</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tinytest<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="at">current =</span> <span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">target =</span> <span class="dv">2</span>, <span class="at">info =</span> <span class="st">&quot;Test A&quot;</span>)</span></code></pre></div>
<pre><code>## ----- FAILED[data]: &lt;--&gt;
##  call| tinytest::expect_equal(current = 2 + 1, target = 2, info = &quot;Test A&quot;)
##  diff| Expected &#39;2&#39;, got &#39;3&#39;
##  info| Test A</code></pre>
<p>Il y a 3 résultats possible pour un test avec <code>tinytest</code> : PASSED, FAILED et SIDEFX.</p>
<p>Les tests FAILED peuvent l’être à cause :</p>
<ul>
<li>d’un résultat différent de l’attendu (<code>data</code>, comme dans l’exemple précédent)</li>
<li>d’une différence dans les attributs (<code>attr</code>)</li>
<li>d’une exception si le code n’a pas fonctionné (<code>excp</code> : erreur ou warning).</li>
</ul>
<p>Les tests SIDEFX révèlent des effets de bords qui peuvent être causés :</p>
<ul>
<li>par un changement de variable environnementale (<code>env</code>)</li>
<li>un changement de répertoire de travail (<code>wdir</code>)</li>
<li>la création de fichiers non attendus dans les répertoires (<code>file</code>).</li>
</ul>
<p><code>tinytest</code> est relativement récent, mais plusieurs packages le mobilisent déjà, comme <a href="https://github.com/eddelbuettel/ttdo/"><code>ttdo</code></a> et <a href="https://gitlab.com/fvafrcu/packager"><code>packager</code></a>.</p>
</div>
<div id="autotest-pour-générer-automatiquement-des-tests" class="section level3">
<h3>autotest, pour générer automatiquement des tests</h3>
<p>Le package <a href="https://docs.ropensci.org/autotest/"><code>autotest</code></a> est un package récent (version 0.0.2.135 au 25/08) permettant la génération automatique de tests relatifs à un package dans son entier ou à une fonction d’un package.</p>
<p>Comment ça marche ?</p>
<p>For each .Rd file in a package, autotest tests the code given in the example section according to the following general steps:</p>
<ol style="list-style-type: decimal">
<li>Extract example lines from the .Rd file;</li>
<li>Identify all function aliases described by that file;</li>
<li>Identify all points at which those functions are called;</li>
<li>Identify all objects passed to those values, including values, classes, attributes, and other properties.</li>
<li>Identify any other parameters not explicitly passed in example code, but defined via default value;</li>
<li>Mutate the values of all parameters according to the kinds of test described in <code>autotest_types()</code>.</li>
</ol>
<p>Les types de tests générés par <code>autotest</code> peuvent être visualisés par la fonction <code>autotest_types()</code> :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x_list_types <span class="ot">&lt;-</span> autotest<span class="sc">::</span><span class="fu">autotest_types</span>() </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x_list_types, <span class="at">n =</span> <span class="dv">8</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="3%" />
<col width="16%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="26%" />
<col width="28%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">test_name</th>
<th align="left">fn_name</th>
<th align="left">parameter</th>
<th align="left">parameter_type</th>
<th align="left">operation</th>
<th align="left">content</th>
<th align="left">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">rect_as_other</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">check for error/warning messages</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">rect_compare_dims</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">expect dimensions are same</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">rect_compare_col_names</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">expect column names are retained</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">rect_compare_col_structure</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">expect all columns retain identical structure</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">extend_rect_class</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Extend existent class with new class</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">replace_rect_class</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Replace class with new class</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">vector_to_list_col</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">vector</td>
<td align="left">Convert vector input to list-columns</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">vector_custom_class</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">vector</td>
<td align="left">Custom class definitions for vector input</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
</div>
<p>Certains tests peuvent être désactivés en utilisant le nom des tests de la colonne <code>x_list_types$test_name</code> et la fonction <code>autotest_types</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>autotest<span class="sc">::</span><span class="fu">autotest_types</span>(<span class="at">notest =</span> <span class="st">&quot;vector_to_list_col&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">8</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="3%" />
<col width="16%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="26%" />
<col width="28%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">test_name</th>
<th align="left">fn_name</th>
<th align="left">parameter</th>
<th align="left">parameter_type</th>
<th align="left">operation</th>
<th align="left">content</th>
<th align="left">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">rect_as_other</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">check for error/warning messages</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">rect_compare_dims</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">expect dimensions are same</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">rect_compare_col_names</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">expect column names are retained</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">rect_compare_col_structure</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Convert one rectangular class to another</td>
<td align="left">expect all columns retain identical structure</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">extend_rect_class</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Extend existent class with new class</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">replace_rect_class</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">rectangular</td>
<td align="left">Replace class with new class</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">vector_to_list_col</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">vector</td>
<td align="left">Convert vector input to list-columns</td>
<td align="left">(Should yield same result)</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">vector_custom_class</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">vector</td>
<td align="left">Custom class definitions for vector input</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
</div>
<p>Les tests générés sont très exigeants sur la documentation des arguments, des objets retournés et de l’adéquation des exemples avec leur description dans la documentation.</p>
<ol style="list-style-type: decimal">
<li><code>error</code> si le test a déclenché une erreur</li>
<li><code>warning</code> si le test a déclenche un warning</li>
<li><code>diagnostic</code> si le test a fonctionné mais qu’il a détecté une incohérence dans la documentation (le test peut être dû à une erreur/warning aussi, mais dans ce cas il concerne uniquement la documentation).</li>
<li><code>message</code> si le test a renvoyé un message.</li>
</ol>
<p>Exemple avec le package <code>aricode</code> :</p>
<p>D’abord on peut identifier l’ensemble des tests qui sont réalisés sans les faire tourner, sur deux fonctions (pour limiter le nombre de tests ici): <code>AMI()</code> et <code>entropy()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aricode)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x_ari <span class="ot">&lt;-</span> autotest<span class="sc">::</span><span class="fu">autotest_package</span>(<span class="st">&quot;aricode&quot;</span>,<span class="at">functions =</span> <span class="fu">c</span>(<span class="st">&quot;AMI&quot;</span>,<span class="st">&quot;entropy&quot;</span>), <span class="at">test =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## </code></pre>
<pre><code>## ── autotesting aricode ──</code></pre>
<pre><code>## </code></pre>
<pre><code>## ✔ [1 / 2]: AMI</code></pre>
<pre><code>## ✔ [2 / 2]: entropy</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(x_ari, <span class="sc">-</span>yaml_hash) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">6</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="4%" />
<col width="13%" />
<col width="5%" />
<col width="10%" />
<col width="10%" />
<col width="34%" />
<col width="18%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">test_name</th>
<th align="left">fn_name</th>
<th align="left">parameter</th>
<th align="left">parameter_type</th>
<th align="left">operation</th>
<th align="left">content</th>
<th align="left">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">int_as_numeric</td>
<td align="left">AMI</td>
<td align="left">c1</td>
<td align="left">integer vector</td>
<td align="left">Integer value converted to numeric</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">vector_custom_class</td>
<td align="left">AMI</td>
<td align="left">c1</td>
<td align="left">vector</td>
<td align="left">Custom class definitions for vector input</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">vector_to_list_col</td>
<td align="left">AMI</td>
<td align="left">c1</td>
<td align="left">vector</td>
<td align="left">Convert vector input to list-columns</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">vector_custom_class</td>
<td align="left">AMI</td>
<td align="left">c2</td>
<td align="left">vector</td>
<td align="left">Custom class definitions for vector input</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">dummy</td>
<td align="left">vector_to_list_col</td>
<td align="left">AMI</td>
<td align="left">c2</td>
<td align="left">vector</td>
<td align="left">Convert vector input to list-columns</td>
<td align="left">(Should yield same result)</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">dummy</td>
<td align="left">return_successful</td>
<td align="left">AMI</td>
<td align="left">(return object)</td>
<td align="left">(return object)</td>
<td align="left">Check that function successfully returns an object</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
</div>
<p>Ici, 26 tests sont identifiés (seulement 6 sont montrés ci dessous). Si on fait tourner la même fonction en activant les tests, <code>autotest_package</code> renvoie uniquement les tests qui ont échoué avec une description plus ou moins précise de la raison.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aricode)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x_ari <span class="ot">&lt;-</span> autotest<span class="sc">::</span><span class="fu">autotest_package</span>(<span class="st">&quot;aricode&quot;</span>,<span class="at">functions =</span> <span class="fu">c</span>(<span class="st">&quot;AMI&quot;</span>,<span class="st">&quot;entropy&quot;</span>), <span class="at">test =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## ── autotesting aricode ──</code></pre>
<pre><code>## </code></pre>
<pre><code>## ✔ [1 / 2]: AMI</code></pre>
<pre><code>## ✔ [2 / 2]: entropy</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(x_ari, <span class="sc">-</span>yaml_hash)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="4%" />
<col width="7%" />
<col width="3%" />
<col width="3%" />
<col width="5%" />
<col width="15%" />
<col width="58%" />
<col width="1%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">test_name</th>
<th align="left">fn_name</th>
<th align="left">parameter</th>
<th align="left">parameter_type</th>
<th align="left">operation</th>
<th align="left">content</th>
<th align="left">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">diagnostic</td>
<td align="left">vector_custom_class</td>
<td align="left">AMI</td>
<td align="left">c2</td>
<td align="left">vector</td>
<td align="left">Custom class definitions for vector input</td>
<td align="left">Function [AMI] errors on vector columns with different classes when submitted as c2 Error message: c1 and c2 must be vectors or factors but not lists.</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">diagnostic</td>
<td align="left">int_as_numeric</td>
<td align="left">entropy</td>
<td align="left">c1</td>
<td align="left">integer vector</td>
<td align="left">Integer value converted to numeric</td>
<td align="left">Function [entropy] returns different values when parameter c1] only demontrated or documented as int-valued is submitted as double.</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">diagnostic</td>
<td align="left">vector_custom_class</td>
<td align="left">entropy</td>
<td align="left">c2</td>
<td align="left">vector</td>
<td align="left">Custom class definitions for vector input</td>
<td align="left">Function [entropy] errors on vector columns with different classes when submitted as c2 Error message: c1 and c2 must be vectors or factors but not lists.</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
</div>
<p>Sur les deux fonctions testées, il n’y a eu aucune erreurs ni warnings, mais deux problèmes de type <code>diagnostic</code> :</p>
<ol style="list-style-type: decimal">
<li><p>Les fonctions n’excluent pas la possibilité que c2 soit une liste, mais elles ne le permettent pas pour autant. La documentation devrait mentionner l’impossibilité d’utiliser des listes pour l’argument <code>c2</code>.</p></li>
<li><p>La documentation montre juste des <em>integer</em> dans les exemples, mais la fonction permet d’utiliser des <em>double</em> et ce avec des résultats différents (d’après le test).</p></li>
</ol>
<p><code>autotest</code> ne permet pas pour l’instant de générer automatiquement des fichiers de tests pour un package, mais peut être mobilisé comme ensemble de test à effectuer sur un package. Une série de fonction <code>expect_xxx</code> permet ainsi de gérer la sortie de la fonction <code>autotest_package</code> afin d’échouer selon la présence d’erreur, de warnings dans la colonne <code>type</code>. Les <code>diagnostic</code> ne sont ici pas pris en compte. Pour vérifier leur absences il faudrait utiliser une estimation du nombre de ligne (voir plus bas). L’inconvénient étant un traçage probablement limité de l’origine des erreurs. L’idée de générer automatiquement les tests individuels est cependant un objectif probable du package.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tinytest<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(autotest<span class="sc">::</span><span class="fu">autotest_package</span>(<span class="st">&quot;aricode&quot;</span>,<span class="at">functions =</span> <span class="fu">c</span>(<span class="st">&quot;AMI&quot;</span>,<span class="st">&quot;entropy&quot;</span>), <span class="at">test =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## ── autotesting aricode ──</code></pre>
<pre><code>## </code></pre>
<pre><code>## ✔ [1 / 2]: AMI</code></pre>
<pre><code>## ✔ [2 / 2]: entropy</code></pre>
<pre><code>## ----- FAILED[data]: &lt;--&gt;
##  call| tinytest::expect_equal(nrow(autotest::autotest_package(&quot;aricode&quot;, 
##  call| functions = c(&quot;AMI&quot;, &quot;entropy&quot;), test = TRUE)), 0)
##  diff| Mean absolute difference: 3</code></pre>
<p>En résumé, <code>autotest</code> permet de mettre en place automatiquement une quantité importante de tests, basés sur la rigueur de la documentation et son adéquation avec le fonctionnement des différentes fonctions. Le niveau d’exigence est cependant très élevé et peut être parfois un peu trop fort. Le package ne s’utilise pas encore de manière très stable et fluide pour des packages plus complexes, avec des dépendances nombreuses ou des fonctions avec des classes de paramètres plus compliquées. La fonction <code>autotest_package</code> peut ainsi renvoyer des erreurs avant d’arriver au moment des tests sans être très explicite sur le problème rencontré.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
